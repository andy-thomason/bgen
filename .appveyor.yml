build: off
platform: x64
image: Visual Studio 2015
environment:
  PLATFORM: "x64"
  CONFIGURATION: "Release"

install:
  - set PATH_ORIGINAL=%PATH%
  - SET ADDITIONALPARAM=/p:LibraryPath="C:\Program Files\Microsoft SDKs\Windows\v7.1\lib\x64;c:\Program Files (x86)\Microsoft Visual Studio 10.0\VC\lib\amd64;C:\Program Files (x86)\Microsoft Visual Studio 10.0\;C:\Program Files (x86)\Microsoft Visual Studio 10.0\lib\amd64;"

build_script:
  - call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" x64
  - powershell -Command "(New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/Horta/18a6bda81f254d6a9f8f61e82101b66b/raw/fd9aa4d3d55687d91c125543f32b0440f1a8ab96/install-zlib.bat', 'install-zlib.bat')" && .\install-zlib.bat
  - type install.log
  - powershell -Command "(New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/Horta/3691adb8790e0d6358a54a00ffe4edd3/raw/81d020fe594419295a190a189e67e62896110e7d/install-zstd.bat', 'install-zstd.bat')" && .\install-zstd.bat
  # - copy "C:\Program Files\zstd\bin\zstd.dll" build\zstd.dll
  # - copy "C:\Program Files\zstd\bin\zstd.dll" build\libzstd.dll
  # - copy deps\zlib\lib\zlib.dll build\zlib.dll
  - mkdir build && cd build
  # - cmake .. -G "NMake Makefiles" -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS=TRUE -DZLIB_ROOT="C:\projects\bgen\deps\zlib" -DZSTD_LIBRARYDIR="C:\projects\bgen\deps\zstd\lib" -DZSTD_INCLUDEDIR="C:\projects\bgen\deps\zstd\include"
  - cmake .. -G "NMake Makefiles" -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS=TRUE
  - nmake
  - ctest
  - nmake install
