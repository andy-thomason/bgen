build: off
platform: x64
image: Visual Studio 2015
environment:
  PLATFORM: "x64"
  CONFIGURATION: "Release"

build_script:
  - call "C:\Program Files\Microsoft SDKs\Windows\v7.1\Bin\SetEnv.cmd" /x64
  - call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" x64
  - choco install cmake
  - set PATH=C:\Program Files\CMake\bin;%PATH%
  - powershell -Command "(New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/Horta/18a6bda81f254d6a9f8f61e82101b66b/raw/c9591f74c191c57d66cd35936097cfa51ac95b78/install-zlib.bat', 'install-zlib.bat')" && .\install-zlib.bat
  - type install.log
  - powershell -Command "(New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/Horta/3691adb8790e0d6358a54a00ffe4edd3/raw/21e693e0edbc2d3e4c74979256246f275fc69d84/install-zstd.bat', 'install-zstd.bat')" && .\install-zstd.bat
  - type install.log
  - powershell -Command "(New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/Horta/e41b29e7c6f9bd74f2732d065e21eea4/raw/9002589f236711bf81eaa22397fb85e03e2bf844/install-progressbar.bat', 'install-progressbar.bat')" && .\install-progressbar.bat
  - type install.log
  - mkdir build && cd build
  # - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
  - cmake .. -G "NMake Makefiles" -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS=TRUE
  - nmake && ctest && nmake install
