build: off
platform: x64
image: Visual Studio 2015
environment:
  PLATFORM: "x64"
  CONFIGURATION: "Release"

install:
  - set PATH_ORIGINAL=%PATH%
  - SET ADDITIONALPARAM=/p:LibraryPath="C:\Program Files\Microsoft SDKs\Windows\v7.1\lib\x64;c:\Program Files (x86)\Microsoft Visual Studio 10.0\VC\lib\amd64;C:\Program Files (x86)\Microsoft Visual Studio 10.0\;C:\Program Files (x86)\Microsoft Visual Studio 10.0\lib\amd64;"

build_script:
  - call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" x64
  - mkdir deps
  - cd deps
  - mkdir zlib
  - cd zlib
  - nuget install zlib -Version 1.2.8.8
  - mkdir lib
  - mkdir include
  - move zlib.v140.windesktop.msvcstl.dyn.rt-dyn.1.2.8.8\lib\native\v140\windesktop\msvcstl\dyn\rt-dyn\x64\Release\*.* lib
  - move zlib.v140.windesktop.msvcstl.dyn.rt-dyn.1.2.8.8\build\native\include\*.* include
  - cd ..
  - powershell -Command "(New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/Horta/3691adb8790e0d6358a54a00ffe4edd3/raw/81d020fe594419295a190a189e67e62896110e7d/install-zstd.bat', 'install-zstd.bat')" && .\install-zstd.bat
  - mkdir build
  - copy "C:/Program Files/zstd/bin/zstd.dll" build/zstd.dll
  - copy "C:/Program Files/zstd/bin/zstd.dll" build/libzstd.dll
  - copy deps\zlib\lib\zlib.dll build\zlib.dll
  - cd build
  - cmake .. -G "NMake Makefiles" -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS=TRUE -DZLIB_ROOT="C:\projects\bgen\deps\zlib" -DZSTD_LIBRARYDIR="C:\projects\bgen\deps\zstd\lib" -DZSTD_INCLUDEDIR="C:\projects\bgen\deps\zstd\include"
  - nmake
  - ctest
  - nmake install
